<!DOCTYPE html>
<html lang="ko">

<head>
  <title>대전시</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" type="image/png" href="assets/favicon.png">
  <style>
    @charset "utf-8";

    @font-face {
      font-family: 'SUITE-Regular';
      src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_2304-2@1.0/SUITE-Regular.woff2') format('woff2');
      font-weight: 800;
      font-style: normal;
    }

    @keyframes scale {
      100% {
        transform: scale(110%);
      }
    }

    #wrap {
      width: 100vw;
      height: 100vh;
      overflow: hidden;
    }

    .none {
      display: none;
    }

    * {
      text-decoration: none;
      font-family: 'SUITE-Regular';
      padding: 0;
      margin: 0;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-use-select: none;
      user-select: none;
      overflow-x: hidden;
      overflow-y: hidden;
    }


    #logo {
      max-height: 50px;
      margin-left: 32px;
      float: left;
    }

    #open-info {
      margin-right: 32px;
      cursor: pointer;
    }

    header {
      background: rgb(0, 0, 0);
      color: rgb(255, 255, 255);
      display: flex;
      justify-content: space-between;
      align-items: center;
      height: 50px;
      width: 100%;
    }

    section {
      display: block;
      justify-content: space-between;
      align-items: center;
      height: 550px;
      position: relative;
      margin: 0 auto;
      overflow: hidden;
    }

    .page {
      top: 30px;
      width: 100%;
      height: inherit;
      overflow: hidden;
      font-size: 2.5em;
      position: relative;
      align-items: center;
      text-align: center;
    }

    .table-wrapper {
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      display: flex;
      justify-content: center;
      align-items: center;
      width: 80%;
      box-sizing: border-box;
      font-size: 18px;
    }

    th,
    td {
      border: 1px solid black;
    }

    th {
      height: 30px;
    }

    td {
      height: 40px;
    }

    textarea {
      resize: none;
    }

    caption {
      padding-top: 2%;
      font-size: 26px;
    }

    .memo {
      cursor: text;
    }

    .memo:hover {
      color: greenyellow;
    }

    #memoSel {
      display: none;
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.2), rgba(255, 255, 255, 0.4));
      position: absolute;
      width: 200px;
      height: 100px;
    }

    #memoSel>* {
      float: left;
    }

    #cancle {
      float: right;
      color: black;
      width: 24px;
      cursor: pointer;
    }

    #cancle:hover {
      background-color: red;
    }

    #selContent {
      margin-left: 5px;
      margin-top: 2px;
    }

    #selContent > input, textarea {
      width: 160px;
    }

    .info {
      display: none;
      position: absolute;
      left: 50%;
      top: 60%;
      padding-left: 30px;
      padding-right: 30px;
      transform: translate(-50%, -50%);
      color: black;
      width: 400px;
      height: 450px;
      box-sizing: border-box;
      font-size: 15px;
      background: #ffffff;
    }

    table {
      border-collapse: collapse;
    }

    #info-cancle {
      text-align: center;
      float: right;
      color: black;
      width: 24px;
      cursor: pointer;
      margin-top: 20px;
      margin-right: 20px;
    }

    #info-cancle:hover {
      background-color: red;
    }

    #imgHolder {
      width: 100px;
      background-color: darkgray;
      height: 100px;
      border-radius: 50%;
      margin-bottom: 10px;
    }

    .img-wrapper {
      width: 380px;
      height: 130px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }

    .info-wrapper {
      overflow: visible !important;
      font-size: 10px;
      margin-top: 10px;
      width: 380px;
      height: 40px;
      display: flex;
      justify-content: start;
    }

    .info-wrapper>* {
      float: left;
      text-align: center;
    }

    #user-name {
      font-size: 19px;
    }

    .interact-wrapper {
      min-width: 320px;
      height: 100px;
      display: flex;
      justify-content: center;
    }

    .interact-wrapper>* {
      width: 80px;
      height: 25px;
      text-align: center;
      font-size: 13px;
      color: white;
      cursor: pointer;
      line-height: 25px;
    }

    #logout {
      float: left;
      background: black;
      border-radius: 10px 10px 10px 10px;
    }

    #resign {
      margin-left: 20px;
      float: right;
      background: black;
      border-radius: 10px 10px 10px 10px;
    }

    #changepassword {
      margin-left: 20px;
      background: black;
      line-height: 25px;
      border-radius: 10px 10px 10px 10px;
    }

    .interact-wrapper>*:hover {
      animation-name: scale;
      animation-duration: 0.5s;
      animation-fill-mode: forwards;
    }

    .alert {
      width: 80vw;
      height: 50px;
      background-color: rgb(146, 102, 249);
      position: absolute;
      margin-top: 60px;
      margin-left: 50vw;
      transform: translate(-50%);
      text-align: center;
      border-radius: 25px 25px 25px 25px;
      font-size: 1.5em;
    }

    .alert p {
      margin-top: 10px;
      color: white;
    }
    #Talert {
      font-size: 40px;
      padding-left: 30px;
      padding-right: 30px;
      transform: translateX(-50%);
      position: absolute;
      left: 50%;
      top: 120px;
      display: none;
      background-color: rgb(255, 255, 255);
      width: 400px;
      height: 70vh;
      box-sizing: border-box;
    }
    #Tvalue {
      float: left;
      margin-top: 20px;
      margin-left: 20px;
      text-align: left;
    }
    #Tvalue p {
      font-size: 20px;
    }
    #T-cancle {
      font-size: 18px;
      text-align: center;
      float: right;
      color: black;
      width: 24px;
      cursor: pointer;
      margin-top: 20px;
      margin-right: 20px;
    }
    #T-cancle:hover {
      background-color: red;
    }

    @media screen and (max-width: 312px) {
      .none {
        display: block;
      }
      .alert {
        display: none;
      }
      #wrap {
        display: none;
      }
    }

    @media screen and (min-width: 500px) {
      .table-wrapper {
        width: 400px;
      }
    }
  </style>
</head>

<body>
  <div class="none">
    <h1>이런!</h1>
    <h2>매우 특이한 스크린을 사용하는 것을 감지했습니다.</h2>
    <h4>크기를 정상적으로 바꿔주세요.</h4>
  </div>
  <div class="alert">
    <p>시간표 변경됨</p>
  </div>
  <div id="wrap">
    <header>
      <a href="/"><img id="logo" src="/assets/logo.png"></a>
      <p id="open-info">내 정보</p>
    </header>
    <section>
      <div id="Talert">
        <div id="T-cancle">X</div>
        <img src="https://upload.wikimedia.org/wikipedia/commons/9/99/Sample_User_Icon.png" alt="" style="height: 100px;margin-left: 10px;margin-top: 40px;">
        <div id="Tvalue"></div>
      </div>
      <div class="info">
        <div id="info-cancle">X</div>
        <div class="img-wrapper">
          <div id="imgHolder">
            <img src="/assets/userpic.png" width="100px" alt="user-img">
          </div>
          <h1 id="user-name">
            <%= username %>님
          </h1>
        </div>
        <div class="info-wrapper">
          <h2 id="user-state">user</h2>
          <h2 id="user-id">ID : <%= stduentID %>
          </h2>
        </div>
        <div class="interact-wrapper">
          <div id="logout" onclick="location.href='/api/mypage/logout'">
            <h4>로그아웃</h4>
          </div>
          <div id="changepassword" onclick="location.href='/api/mypage/makeaprincess">
            <h4>비밀번호 변경</h4>
          </div>
          <div id="resign" onclick="if(confirm('정말 탈퇴하시겠습니까?')){location.href='/api/mypage/account-delete'}">
            <h4>탈퇴</h4>
          </div>
        </div>
      </div>
      <div class="page">
        <div class="table-wrapper">
          <table>
            <caption><b>
              <%= username %>님(<%= userRoom %>반)의
                    <br>오늘의 시간표
              </b></caption>
            <thead>
              <tr>
                <th width="80px">교시</th>
                <th width="60px">과목</th>
                <th width="140px">담당 교사</th>
                <th width="120px">메모</th>
              </tr>
            </thead>
            <tbody>
              <tr style="background-color: <%= m1st %>;">
                <td>1교시</td>
                <td onclick="getTinfo('<%= s1st %>')>
                  <%= q1st %>
                </td>
                <td><%= info1st %></td>
                <td class="memo" onclick="sel(0)">NaN</td>
              </tr>
              <tr style="background-color: <%= m2st %>;">
                <td>2교시</td>
                <td onclick="getTinfo('<%= s2st %>')">
                  <%= q2st %>
                </td>
                <td><%= info2st %></td>
                <td class="memo" onclick="sel(1)">NaN</td>
              </tr>
              <tr style="background-color: <%= m3st %>;">
                <td>3교시</td>
                <td onclick="getTinfo('<%= s3st %>')">
                  <%= q3st %>
                </td>
                <td><%= info3st %></td>
                <td class="memo" onclick="sel(2)">NaN</td>
              </tr>
              <tr style="background-color: <%= m4st %>;">
                <td>4교시</td>
                <td onclick="getTinfo('<%= s4st %>')">
                  <%= q4st %>
                </td>
                <td><%= info4st %></td>
                <td class="memo" onclick="sel(3)">NaN</td>
              </tr>
              <tr style="background-color: <%= m5st %>;">
                <td>5교시</td>
                <td onclick="getTinfo('<%= s5st %>')">
                  <%= q5st %>
                </td>
                <td><%= info5st %></td>
                <td class="memo" onclick="sel(4)">NaN</td>
              </tr>
              <tr style="background-color: <%= m6st %>;">
                <td>6교시</td>
                <td onclick="getTinfo('<%= s6st %>')">
                  <%= q6st %>
                </td>
                <td><%= info6st %></td>
                <td class="memo" onclick="sel(5)">NaN</td>
              </tr>
              <tr style="background-color: <%= m7st %>;">
                <td>7교시</td>
                <td onclick="getTinfo('<%= s7st %>')">
                  <%= q7st %>
                </td>
                <td><%= info7st %></td>
                <td class="memo" onclick="sel(6)">NaN</td>
              </tr>
            </tbody>
        </div>
      </div>
      <div id="memoSel">
        <div id="cancle" onclick="cancle()">X</div>
        <div id="selContent">
          <input id="title" type="text" oninput="update()" size="20" placeholder="제목">
          <br>
          <textarea id="info" oninput="update()" placeholder="내용" cols="21" rows="4"></textarea>
        </div>
      </div>
    </section>
  </div>
  <script>
    let Tinfo = document.getElementById('Talert');
    // 메모
    let memoView = document.getElementsByClassName("memo");
    let memoTitle = document.getElementById("title");
    let memoSel = document.getElementById("memoSel");
    let memoInfo = document.getElementById("info");
    // 페이지
    let myInfo = document.getElementsByClassName("info")[0];
    let page = document.getElementsByClassName("page")[0];
    // 메모 팝업 필드
    var select = -1;
    var memoData = [['1', ''], ['1', ''], ['1', ''], ['1', ''], ['1', ''], ['1', ''], ['1', '']];

    // api 요청
    const getTinfo = (link) => {
      fetch(`/api/teacherinfo/${link}`)
        .then((response) => response.json())
        .then((data) => {
          document.getElementById("Tvalue").innerHTML = `${data['teacher_name']} 선생님<br><p>교무실:${data['teacher_room']}</p>`
          page.style.display = 'none';
          Tinfo.style.display = 'block';
        });
    }

    var condition =  <%= alertView %>; 
    if (!condition) {
      var elements = document.querySelectorAll('.alert'); // alert 클래스를 가진 모든 요소 선택
      for (var i = 0; i < elements.length; i++) {
        elements[i].style.display = 'none'; // display 속성을 none으로 설정하여 숨김
      }
    }

    // element display id로 변경 
    const show = (id) => {
      document.getElementById(id).style.display = "block";
    }
    const hide = (id) => {
      document.getElementById(id).style.display = "none";
    }

    // 로직 변경 필요
    const loadMemo = () => {
      var temp;
      for (var i = 0; i < 7; i++) {
        temp = memoData[i][0];
        if (memoData[i][0].length > 10) {
          temp = memoData[i][0].slice(0, 7) + "...";
        }
        memoView[i].innerText = temp;
      }
    }
    // 메모 요소 클릭 이벤트
    const sel = (n) => {
      select = n;
      memoTitle.value = memoData[select][0];
      memoInfo.value = memoData[select][1];
      show("memoSel");
    }
    // 메모 닫기 버튼 클릭 이벤트
    const cancle = () => {
      hide("memoSel");
      loadMemo();
    }
    // 메모 내용 반영
    function update() {
      memoData[select][0] = memoTitle.value;
      memoData[select][1] = memoInfo.value;
    }
    // info 열기
    document.getElementById("open-info").addEventListener("mousedown", function (e) {
      page.style.display = "none";
      Tinfo.style.display = 'none';
      myInfo.style.display = "block";
    });
    // info 닫기
    document.getElementById("info-cancle").addEventListener("mousedown", function (e) {
      myInfo.style.display = "none";
      page.style.display = "block";
    });

    document.getElementById("T-cancle").addEventListener("mousedown", () => {
      Tinfo.style.display = 'none';
      page.style.display = 'block';
    });

    // 더미데이터 로드
    loadMemo();
  </script>
</body>
